id: hackers-app
name: Hackers App
summary: The full Hackers App RO demo
name_template: "${project_name}-app"
details: |
  This scenario sets up the complete Hackers App demonstration environment featuring a full-stack application with three services.

required_properties:
  - SERVICENOW_URL
  - IMAGE_BUILDER_AWS_ROLE_ARN
  - AWS_REGION
  - ECR_REGISTRY
required_secrets:
  - KUBECONFIG
  - UNIFY_TOKEN
  - JIRA_URL
  - JIRA_USERNAME
  - JIRA_TOKEN
  - SERVICENOW_USERNAME
  - SERVICENOW_PASSWORD

repositories:
  - source: cb-demos/hackers-web-template
    repo_name_template: "${project_name}-web"
    create_component: true
    target_org: "${target_org}"
    replacements:
      TARGET_ORG: "${target_org}"
      PROJECT_NAME: "${project_name}"
      REPLACE_ME_USE_VPC: "${env.USE_VPC}"
      REPLACE_ME_FM_INSTANCE: "${env.FM_INSTANCE}"
    files_to_modify:
      - ".cloudbees/workflows/deploy.yaml"
      - ".cloudbees/workflows/build.yaml"
  - source: cb-demos/hackers-api-template
    target_org: "${target_org}"
    create_component: true
    repo_name_template: "${project_name}-api"
    replacements:
      TARGET_ORG: "${target_org}"
      PROJECT_NAME: "${project_name}"
    files_to_modify:
      - ".cloudbees/workflows/deploy.yaml"
      - ".cloudbees/workflows/build.yaml"
  - source: cb-demos/hackers-auth-template
    target_org: "${target_org}"
    create_component: true
    repo_name_template: "${project_name}-auth"
    replacements:
      TARGET_ORG: "${target_org}"
      PROJECT_NAME: "${project_name}"
    files_to_modify:
      - ".cloudbees/workflows/deploy.yaml"
      - ".cloudbees/workflows/build.yaml"
  - source: cb-demos/hackers-app-template
    target_org: "${target_org}"
    create_component: false
    repo_name_template: "${project_name}-app"
    replacements:
      TARGET_ORG: "${target_org}"
      PROJECT_NAME: "${project_name}"
      REPLACE_ME_ORG_ID: "${organization_id}"
    files_to_modify:
      - ".cloudbees/workflows/deployer.yaml"
      - ".cloudbees/workflows/full-release.yaml"
      - ".cloudbees/workflows/full-release-snow.yaml"
  - source: cb-demos/hackers-workflows-template
    target_org: "${target_org}"
    create_component: false
    repo_name_template: "${project_name}-workflows"
applications:
  - name: "${project_name}-app"
    repository: "${target_org}/${project_name}-app"
    components:
      - "${project_name}-web"
      - "${project_name}-api"
      - "${project_name}-auth"
    environments:
      - "${project_name}-qa"
      - "${project_name}-staging"
      - "${project_name}-prod"
environments:
  - name: "${project_name}-qa"
    env:
      - name: "namespace"
        value: "${project_name}-qa"
    create_fm_token_var: true
    flags:
      - "default.score"
  - name: "${project_name}-staging"
    env:
      - name: "namespace"
        value: "${project_name}-staging"
    create_fm_token_var: true
    flags:
      - "default.score"
  - name: "${project_name}-prod"
    env:
      - name: "namespace"
        value: "${project_name}-prod"
    create_fm_token_var: true
    flags:
      - "default.score"
flags:
  - name: "default.score"
    type: boolean
parameter_schema:
  properties:
    project_name:
      type: string
      pattern: "^[a-z0-9-]+$"
      description: The name of the project (lowercase, alphanumeric with hyphens)
    target_org:
      type: string
      pattern: "^[a-z0-9-]+$"
      description: The GitHub organization to create the repository in
  required:
    - project_name
    - target_org
