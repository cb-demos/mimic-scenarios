id: insurancestack-demo
name: InsuranceStack Insurance Platform
summary: Full-stack insurance platform (web + 5 Go microservices in monorepo)
details: |
  InsuranceStack is a complete insurance management platform demo showcasing:
  - React web application with reactive feature management (SSE)
  - 5 Go microservices (policy, claims, pricing, customer, payments)
  - CloudBees CI/CD workflows with monorepo structure
  - Helm-based Kubernetes deployment
  - 7 feature flags with real-time updates
  - Subdomain-based routing with wildcard DNS

  This scenario automatically creates:
  - GitHub repository (forked from CB-InsuranceStack/InsuranceStack)
  - CloudBees component
  - CloudBees environment with FM_TOKEN variable
  - CloudBees application linking component and environment

  REQUIRED: KUBECONFIG secret must exist at organization level
  The scenario will prompt you to create it if missing.

  After setup completes, manually trigger the build-and-test workflow to deploy.
  The application will be available at:
  https://insurancestack-demo-insurance-stack-{environment}.demos.se-main-demo.sa-demo.beescloud.com

  Example: https://insurancestack-demo-insurance-stack-dev.demos.se-main-demo.sa-demo.beescloud.com

  URL Pattern: {app_name}-{instance_id}-{environment_name}.{base_domain}
  - app_name: "insurancestack" (configured in workflow)
  - instance_id: "demo" (default in workflow)
  - environment_name: "insurance-stack-{environment}" (Kubernetes namespace)
  - base_domain: "demos.se-main-demo.sa-demo.beescloud.com" (wildcard DNS)

parameter_schema:
  properties:
    project_name:
      type: string
      description: Project name (used for repo, component, and application)
      placeholder: insurancestack
      pattern: "^[a-z0-9-]+$"
    target_org:
      type: string
      description: GitHub organization for repository
      placeholder: CB-InsuranceStack
      pattern: "^[a-zA-Z0-9-]+$"
    environment:
      type: string
      description: Deployment environment name
      enum: ["dev", "staging", "prod"]
      default: dev
  required:
    - project_name
    - target_org
    - environment

required_secrets:
  - KUBECONFIG

repositories:
  - source: CB-InsuranceStack/InsuranceStack
    target_org: "${target_org}"
    repo_name_template: "${project_name}"
    create_component: true

environments:
  - name: "${project_name}-${environment}"
    env:
      - name: ENVIRONMENT
        value: "${environment}"
      - name: PROJECT_NAME
        value: "${project_name}"
    create_fm_token_var: true

applications:
  - name: "${project_name}-app"
    components:
      - "${project_name}"
    environments:
      - "${project_name}-${environment}"
